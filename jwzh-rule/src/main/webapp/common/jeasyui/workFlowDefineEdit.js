// 工作流程定义
// author : redstorm
// 2014-05-12
var BLS=false;var BA=true;var DA=false;var MTO=null;var STO=null;var MX, MY;var TX, TY;var AGOT=0;var AGOL=0;var tacheCountValue=1;var transCountValue=0;var ST="";var SC=0;function body_resize() {var documentSize=getDocumentSize();var panelDivObj=document.getElementById("panelDiv");panelDivObj.style.width=documentSize.width + "px";var panelOffsetTop=document.getElementById("toolbarTable").offsetHeight;panelDivObj.style.height=(documentSize.height - panelOffsetTop) + "px";};function document_onKeyDown(e) {var curTarget=e.target;var curTagName=curTarget.tagName;var curTargetID=curTarget.id;var keyCode=e.keyCode;if (keyCode == 8 || keyCode == 46) {if (ST != "") {if (ST == "tache") {if (MTO != null) {var moveTacheNo=MTO.id.substring(10);if (document.forms["dataForm"].elements["TACHETYPE" + moveTacheNo].value == "1") {topMessagerAlert("", "流程开始环节不能被删除！");return;}var moveTempLine="";var objInput=$('#panelDiv').find("div");var divType="";for (var i=0; i < objInput.length; i++) {var objItem=objInput[i];var tempID=objItem.id;if (tempID != "" && tempID.indexOf("transDiv") == 0) {tempID=tempID.substring(8);var found_address=tempID.indexOf("__");var objLeft=tempID.substr(0, found_address);var objRight=tempID.substr(found_address + 2);if (moveTacheNo == objLeft || moveTacheNo == objRight) {moveTempLine=moveTempLine + tempID + ",";}}} if (moveTempLine != "") {moveTempLine=moveTempLine.substr(0, moveTempLine.length - 1);var tempedArray=moveTempLine.split(",");for (var jj=0; jj < tempedArray.length; jj++) {var found_address=tempedArray[jj].indexOf("__");deleteDivLine(tempedArray[jj].substr(0,found_address), tempedArray[jj].substr(found_address + 2));}}MTO.outerHTML="";var TDO=document.getElementById("tacheDiv" + moveTacheNo);if (TDO != null) {TDO.outerHTML="";}MTO=null;ST="";SC=0;flowButtonLine_empty();}} else if (ST == "trans") {if (STO != null) {var transID=STO.id;var found_address=transID.indexOf("__");var FTN=transID.substring(8, found_address);var TTN=transID.substr(found_address + 2);deleteDivLine(FTN, TTN);STO=null;ST="";}}}}};function document_onMouseDown(e) {var curTarget=e.target;var curTagName=curTarget.tagName;var curTargetID=curTarget.id;var isMouseLeft=false;if (IE) {if (e.button == 1) {isMouseLeft=true;}}else {if (e.button == 0) {isMouseLeft=true;}}if (isMouseLeft) {if (curTagName == "DIV") {if (curTargetID == "panelDiv") {setEmptySelected();}else {var parentTransDiv=curTarget.getAttribute("parentTransDiv");if (parentTransDiv != null) {setEmptySelected();ST="trans";STO=document.getElementById("transDiv" + parentTransDiv);STO.className="transDivSelect";var objInput= $(STO).find("div");for (var i=0; i < objInput.length; i++) {var objItem=objInput[i];var curClassName=objItem.className; curClassName=curClassName.replace("1", "2");objItem.className=curClassName;}}}}else if (curTagName == "TD") {if (curTargetID != null && curTargetID.indexOf("tacheTd") == 0) {var tacheNo=curTargetID.substring(7);if (BLS) {var sourceTacheTypeObject=document.forms["dataForm"].elements["TACHETYPE" + SC];var targetTacheTypeObject=document.forms["dataForm"].elements["TACHETYPE" + tacheNo];if (SC == tacheNo) {return;}if (targetTacheTypeObject.value == "1") {topMessagerAlert("", "流程开始环节不能作为目标环节连线！");flowButtonLine_empty();return;}else if (sourceTacheTypeObject.value == "1" && targetTacheTypeObject.value == "3") {topMessagerAlert("", "流程开始环节与流程结束环节不能直接连线！");flowButtonLine_empty();return;}else {var createLineDiv="transDiv" + SC + "__" + tacheNo;if (document.getElementById(createLineDiv) != null) {topMessagerAlert("", "已存在当前环节之间的流向连接！");flowButtonLine_empty();return;}else {if (sourceTacheTypeObject.value == "1") {var sourceTacheTableObject=document.getElementById("tacheTable" + SC);var sourceOutExist="*"; if (sourceTacheTableObject != null) {sourceOutExist=sourceTacheTableObject.getAttribute("outExist"); }if (sourceOutExist != "") {topMessagerAlert("", "开始环节只能与一个流转环节相连！");flowButtonLine_empty();return;}else {createDivLine(SC, tacheNo, true, true);setEmptySelected();return;}}else {createDivLine(SC, tacheNo, true, true);setEmptySelected();return;}}}}setEmptySelected();DA=true;ST="tache";SC=tacheNo;MTO=document.getElementById("tacheTable" + tacheNo);var curClassName=MTO.className; curClassName=curClassName.replace("1", "2");MTO.className=curClassName;MX=MTO.offsetLeft;MY=MTO.offsetTop;TX=e.clientX;TY=e.clientY;}else if (curTargetID == "flowButtonLine") {if (ST == "tache") {var tacheTypeObject=document.forms["dataForm"].elements["TACHETYPE" + SC];if (tacheTypeObject != null) {if (tacheTypeObject.value == "1" || tacheTypeObject.value == "2") {BLS=true;}else {topMessagerAlert("", "流程结束环节不能作为起始环节连线！");}}}else {topMessagerAlert("", "请选择一个起始环节再点击环节连线！");}}else {setEmptySelected();}}else {setEmptySelected();}}};function document_onMouseUp(e) {var curTarget=e.target;var curTagName=curTarget.tagName;var curTargetID=curTarget.id;if (DA) {DA=false;if (BA) {MTO.style.left=Math.round((MTO.offsetLeft + AGOL)/12)*12 - AGOL;MTO.style.top=Math.round((MTO.offsetTop + AGOT)/12)*12 - AGOT;}if (MX != MTO.offsetLeft || MY != MTO.offsetTop) {var moveTempLine="";var divType="";var moveTacheNo=MTO.id.substring(10);var objInput=$('#panelDiv').find("div");for (var i=0; i < objInput.length; i++) {var objItem=objInput[i];var tempID=objItem.id;if (tempID != "" && tempID.indexOf("transDiv") == 0) {tempID=tempID.substring(8);var found_address=tempID.indexOf("__");var objLeft=tempID.substr(0, found_address);var objRight=tempID.substr(found_address + 2);if (moveTacheNo == objLeft || moveTacheNo == objRight) {moveTempLine=moveTempLine + tempID + ",";}}} if (moveTempLine != "") {moveTempLine=moveTempLine.substr(0, moveTempLine.length - 1);var tempedArray=moveTempLine.split(",");for (var jj=0; jj < tempedArray.length; jj++) {var found_address=tempedArray[jj].indexOf("__");createDivLine(tempedArray[jj].substr(0,found_address), tempedArray[jj].substr(found_address + 2), false, false);}}}}};function document_onMouseMove(e) {if (DA) {var isMouseLeft=false;if (IE) {if (e.button == 1) {isMouseLeft=true;}}else {if (e.button == 0) {isMouseLeft=true;}}if (isMouseLeft) {if (MX + e.clientX - TX > 0 && MY + e.clientY - TY > 0) {MTO.style.left=MX + e.clientX - TX;MTO.style.top=MY + e.clientY - TY;}}}};function createDivLine(FTN, TTN, isNew, isOpenDialog) {var divID="transDiv" + FTN + "__" + TTN;var tDataDivID="tDataDiv" + FTN + "__" + TTN;var fromObject=document.getElementById("tacheTable" + FTN);var toObject=document.getElementById("tacheTable" + TTN);var existOutPlace=0;var existInPlace=0;var fromArrayOutPlace=fromObject.getAttribute("outPlace").split(",");var fromArrayInExist=fromObject.getAttribute("inExist").split(",");var transitionName="";var dataDiv=new StringBuffer();var canOut="";for (var i=0; i < fromArrayOutPlace.length; i++) {var validFalg=true;for (var j=0; j < fromArrayInExist.length; j++) {if (fromArrayOutPlace[i] == fromArrayInExist[j]) {validFalg=false;break;}}if (validFalg) {canOut += fromArrayOutPlace[i] + ",";}else { fromArrayOutPlace[i]="*";existOutPlace ++;}}if (canOut != "") {canOut=canOut.substr(0, canOut.length - 1);}var toArrayInPlace=toObject.getAttribute("inPlace").split(",");var toArrayOutExist=toObject.getAttribute("outExist").split(",");var canIn="";for (var i=0; i < toArrayInPlace.length; i++) {var validFalg=true;for (var j=0; j < toArrayOutExist.length; j++) {if (toArrayInPlace[i] == toArrayOutExist[j]) {validFalg=false;break;}}if (validFalg) {canIn += toArrayInPlace[i] + ",";}else { toArrayInPlace[i]="*";existInPlace ++;} }if (canIn != "") {canIn=canIn.substr(0, canIn.length - 1);}var yesOut="";var yesIn="";var isAuto="1";var transName="";var linkType="";var oldYesOut="";var oldYesIn="";if (document.forms["dataForm"].elements["TACHETYPE" + FTN].value == "1") {linkType="1";}else if (document.forms["dataForm"].elements["TACHETYPE" + TTN].value == "3") {linkType="3";}else {linkType="2";}var TDO2=null;var transNo="";if (!isNew) {TDO2=document.getElementById(divID);transNo=TDO2.getAttribute("transNo");oldYesOut=TDO2.getAttribute("yesOut");oldYesIn=TDO2.getAttribute("yesIn");}else {transCountValue=transCountValue + 1;transNo="" + transCountValue;document.getElementById("transCount").value=transCountValue;}if (isOpenDialog) {var PA=[];PA['parentWindow']=window;PA['linkType']=linkType;PA['canOut']=canOut;PA['canIn']=canIn;if (!isNew) {PA['oldYesOut']=oldYesOut;PA['oldYesIn']=oldYesIn;PA['isAuto']='0';PA['TRANSITIONTYPE']=document.forms["dataForm"].elements["TRANSITIONTYPE" + transNo].value;PA['STARTTACHEFINISH']=document.forms["dataForm"].elements["STARTTACHEFINISH" + transNo].value;PA['TRANSITIONNAME']=document.forms["dataForm"].elements["TRANSITIONNAME" + transNo].value;PA['TRANSITIONNAMEDESC']=document.forms["dataForm"].elements["TRANSITIONNAMEDESC" + transNo].value;PA['PROCESSPASS']=document.forms["dataForm"].elements["PROCESSPASS" + transNo].value;PA['PROCESSEND']=document.forms["dataForm"].elements["PROCESSEND" + transNo].value;PA['CONDITONPARAMETER']=document.forms["dataForm"].elements["CONDITONPARAMETER" + transNo].value;PA['CONDITONPARAMETERTYPE']=document.forms["dataForm"].elements["CONDITONPARAMETERTYPE" + transNo].value;PA['CONDITONOPERATOR']=document.forms["dataForm"].elements["CONDITONOPERATOR" + transNo].value;PA['CONDITONVALUE']=document.forms["dataForm"].elements["CONDITONVALUE" + transNo].value;PA['CONDITIONEXIST']=document.forms["dataForm"].elements["CONDITIONEXIST" + transNo].value;PA['EVENTCLASS']=document.forms["dataForm"].elements["EVENTCLASS" + transNo].value;PA['EVENTMETHOD']=document.forms["dataForm"].elements["EVENTMETHOD" + transNo].value;}else {PA['oldYesOut']='';PA['oldYesIn']='';PA['TRANSITIONTYPE']='';PA['STARTTACHEFINISH']='';PA['TRANSITIONNAME']='';PA['TRANSITIONNAMEDESC']='';PA['PROCESSPASS']='';PA['PROCESSEND']='';PA['CONDITONPARAMETER']='';PA['CONDITONPARAMETERTYPE']='';PA['CONDITONOPERATOR']='';PA['CONDITONVALUE']='';PA['CONDITIONEXIST']='';PA['EVENTCLASS']='';PA['EVENTMETHOD']='';PA['isAuto']='1';}var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var openURL=contextPath + "/wfDeProcess/defineTransition?myTime=" + myTime;var dataOptions={title: '&nbsp;环节流向管理',width: 850,height: 420,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var formObject=iframeObject.$('form').first();if (formObject) {checkComboIsClosed(iframeObject, formObject);if (formObject.form('validate')) {var RO=iframeObject.ok_execute();if (RO == null) {return;}if (!isNew) {dataDiv.append("<input type=\"hidden\" name=\"TRANSITIONID"+ transNo +"\" anchor=\"TRANSITIONID"+ transNo +"\" value=\""+ document.forms["dataForm"].elements["TRANSITIONID" + transNo].value +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"STARTTACHEID"+ transNo +"\" value=\""+ document.forms["dataForm"].elements["STARTTACHEID" + transNo].value +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"ENDTACHEID"+ transNo +"\" value=\""+ document.forms["dataForm"].elements["ENDTACHEID" + transNo].value +"\"/>");}else {dataDiv.append("<input type=\"hidden\" name=\"TRANSITIONID"+ transNo +"\" anchor=\"TRANSITIONID"+ transNo +"\" value=\"\"/>");dataDiv.append("<input type=\"hidden\" name=\"STARTTACHEID"+ transNo +"\" value=\""+ FTN +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"ENDTACHEID"+ transNo +"\" value=\""+ TTN +"\"/>");}dataDiv.append("<input type=\"hidden\" name=\"TRANSITIONTYPE"+ transNo +"\" value=\""+ RO['TRANSITIONTYPE'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"STARTTACHEFINISH"+ transNo +"\" value=\""+ RO['STARTTACHEFINISH'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"TRANSITIONNAME"+ transNo +"\" value=\""+ RO['TRANSITIONNAME'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"TRANSITIONNAMEDESC"+ transNo +"\" value=\""+ RO['TRANSITIONNAMEDESC'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"PROCESSPASS"+ transNo +"\" value=\""+ RO['PROCESSPASS'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"PROCESSEND"+ transNo +"\" value=\""+ RO['PROCESSEND'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"CONDITONPARAMETER"+ transNo +"\" value=\""+ RO['CONDITONPARAMETER'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"CONDITONPARAMETERTYPE"+ transNo +"\" value=\""+ RO['CONDITONPARAMETERTYPE'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"CONDITONOPERATOR"+ transNo +"\" value=\""+ RO['CONDITONOPERATOR'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"CONDITONVALUE"+ transNo +"\" value=\""+ RO['CONDITONVALUE'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"CONDITIONEXIST"+ transNo +"\" value=\""+ RO['CONDITIONEXIST'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"EVENTCLASS"+ transNo +"\" value=\""+ RO['EVENTCLASS'] +"\"/>");dataDiv.append("<input type=\"hidden\" name=\"EVENTMETHOD"+ transNo +"\" value=\""+ RO['EVENTMETHOD'] +"\"/>");isAuto=RO['isAuto'];yesOut=RO['yesOut'];yesIn=RO['yesIn'];transitionName=RO['TRANSITIONNAME'];refreshDivLine(divID, tDataDivID, FTN, TTN, transNo, fromObject, toObject, TDO2, transitionName, dataDiv, isAuto, yesOut, yesIn, oldYesOut, oldYesIn, fromArrayOutPlace, toArrayInPlace, isNew, linkType, isOpenDialog);$('#' + windowID).dialog('close');}}}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);}else {refreshDivLine(divID, tDataDivID, FTN, TTN, transNo, fromObject, toObject, TDO2, transitionName, dataDiv, isAuto, yesOut, yesIn, oldYesOut, oldYesIn, fromArrayOutPlace, toArrayInPlace, isNew, linkType, isOpenDialog);}};function refreshDivLine(divID, tDataDivID, FTN, TTN, transNo, fromObject, toObject, TDO2, transitionName, dataDiv, isAuto, yesOut, yesIn, oldYesOut, oldYesIn, fromArrayOutPlace, toArrayInPlace, isNew, linkType, isOpenDialog) {var FL=fromObject.offsetLeft;var FT=fromObject.offsetTop;var FR=FL + fromObject.offsetWidth;var FD=FT + fromObject.offsetHeight;var FCL=FL + Math.round((fromObject.offsetWidth - 3) / 2);var FCT=FT + Math.round((fromObject.offsetHeight - 3) / 2);var TL=toObject.offsetLeft;var TT=toObject.offsetTop;var TR=TL + toObject.offsetWidth;var TD=TT + toObject.offsetHeight;var TCL=TL + Math.round((toObject.offsetWidth - 3) / 2);var TCT=TT + Math.round((toObject.offsetHeight - 3) / 2);var GO="";var G0="";var offset=1;var startLeft=0;var startTop=0;var endLeft=0;var endTop=0;if (TCL < FL && TCT < FT) {GO="2,1,4,3";G0="4,3,1,2";offset=1;}else if (TCL >= FL && TCL <= FR && TCT < FT) {GO="1,2,3,4";G0="4,2,3,1";offset=2;}else if (TCL > FR && TCT < FT) {GO="3,1,4,2";G0="4,2,3,1";offset=3;}else if (TCL < FL && TCT >= FT && TCT <= FD) {GO="2,4,1,3";G0="3,1,4,2";offset=4;}else if (TCL > FR && TCT >= FT && TCT <= FD) {GO="3,4,1,2";G0="2,1,4,3";offset=6;}else if (TCL < FL && TCT > FD) {GO="4,2,3,1";G0="1,3,4,2";offset=7;}else if (TCL >= FL && TCL <= FR && TCT > FD) {GO="4,2,3,1";G0="1,2,3,4";offset=8;}else if (TCL > FR && TCT > FD) {GO="4,3,2,1";G0="1,2,3,4";offset=9;}else {GO="4,3,2,1";G0="1,2,3,4";offset=5;}if (isAuto == "1") {yesOut="";yesIn="";var goodAarrayOut=GO.split(",");var goodAarrayIn=G0.split(",");for (var i=0; i < goodAarrayOut.length; i++) {for (var j=0; j < fromArrayOutPlace.length; j++) { if (goodAarrayOut[i] == fromArrayOutPlace[j]) {yesOut=fromArrayOutPlace[j];break;}}if (yesOut != "") {break;}}var sameOutIn=false;switch (offset) {case 2 :if (yesOut == "2" || yesOut == "3") {sameOutIn=true;}break;case 4 :if (yesOut == "1" || yesOut == "4") {sameOutIn=true;}break;case 6 :if (yesOut == "1" || yesOut == "4") {sameOutIn=true;}break;case 8 :if (yesOut == "2" || yesOut == "3") {sameOutIn=true;}break;}if (sameOutIn) {for (var j=0; j < toArrayInPlace.length; j++) {if (yesOut == toArrayInPlace[j]) {yesIn=toArrayInPlace[j];break;}}}if (yesIn == "") {for (var i=0; i < goodAarrayIn.length; i++) {for (var j=0; j < toArrayInPlace.length; j++) { if (goodAarrayIn[i] == toArrayInPlace[j]) {yesIn=toArrayInPlace[j];break;}}if (yesIn != "") {break;}}}}var AD=new StringBuffer();var LD="parentTransDiv=\""+ FTN + "__" + TTN +"\" ondblclick=\"lineDoubleClick(this)\"";switch (yesOut) {case "1" :AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"height: 16; left: "+ (FCL - 3) +"; top: "+ (FT - 16) +";\"></div>");startLeft=FCL;startTop=FT - 16;break;case "2" :AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"width: 16; left: "+ (FL - 16) +"; top: "+ (FCT - 3) +";\"></div>");startLeft=FL - 16;startTop=FCT;break;case "3" :AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"width: 16; left: "+ (FR - 3) +"; top: "+ (FCT - 3) +";\"></div>");startLeft=FR - 3 + 16;startTop=FCT;break;case "4" :AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"height: 16; left: "+ (FCL - 3) +"; top: "+ (FD - 3) +";\"></div>");startLeft=FCL;startTop=FD - 3 + 16;break;} switch (yesIn) {case "1" :AD.append("<div "+ LD +" class=\"flowArrowDown1\" style=\"left: "+ (TCL - 3) +"; top: "+ (TT - 16) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"height: 16; left: "+ (TCL - 3) +"; top: "+ (TT - 32) +";\"></div>");endLeft=TCL;endTop=TT - 32;break;case "2" :AD.append("<div "+ LD +" class=\"flowArrowRight1\" style=\"left: "+ (TL - 16) +"; top: "+ (TCT - 3) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"width: 16; left: "+ (TL - 16 - 16) +"; top: "+ (TCT - 3) +";\"></div>");endLeft=TL - 16 - 16;endTop=TCT;break;case "3" :AD.append("<div "+ LD +" class=\"flowArrowLeft1\" style=\"left: "+ (TR - 3) +"; top: "+ (TCT - 3) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"width: 16; left: "+ (TR - 3 + 16) +"; top: "+ (TCT - 3) +";\"></div>");endLeft=TR - 3 + 16 + 16;endTop=TCT;break;case "4" :AD.append("<div "+ LD +" class=\"flowArrowUp1\" style=\"left: "+ (TCL - 3) +"; top: "+ (TD - 3) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"height: 16; left: "+ (TCL - 3) +"; top: "+ (TD - 3 + 16) +";\"></div>");endLeft=TCL;endTop=TD - 3 + 16 + 16;break;}switch (yesOut) {case "1" :if (yesIn == "4") { if (offset >= 4 || (offset < 4 && endTop > startTop)) {tempCenterLeft=startLeft - Math.round((startLeft - endLeft) / 2);AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft,startLeft) +"; top: "+ (startTop - 3) +"; width: "+ (Math.abs(startLeft - tempCenterLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (tempCenterLeft - 3) +"; top: "+ Math.min(startTop, endTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft,endLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(endLeft - tempCenterLeft) + 1) +";\"></div>");}else {tempCenterTop=startTop - Math.round((startTop - endTop) / 2);AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ tempCenterTop +"; height: "+ (Math.abs(tempCenterTop - startTop) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (tempCenterTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ endTop +"; height: "+ (Math.abs(endTop - tempCenterTop) + 1) +";\"></div>");}}else if (yesIn == "1" && endTop < startTop) {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}else {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+(Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}break;case "2" :if (yesIn == "3") { if ((offset != 1 && offset != 4 && offset != 7) || ((offset == 1 || offset == 4 || offset == 7) && endLeft > startLeft)) {tempCenterTop=startTop - Math.round((startTop - endTop) / 2);AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ Math.min(startTop,tempCenterTop) +"; height: "+ (Math.abs(tempCenterTop - startTop) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(startLeft,endLeft) +"; top: "+ (tempCenterTop - 3) +"; width: "+(Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ Math.min(endTop, tempCenterTop) +"; height: "+ (Math.abs(endTop - tempCenterTop) + 1) +";\"></div>");}else {tempCenterLeft=startLeft - Math.round((startLeft - endLeft) / 2);AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+(Math.abs(startLeft - tempCenterLeft) + 1) +";\"></div>");if (startTop != endTop) { AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (tempCenterLeft - 3) +"; top: "+ Math.min(startTop, endTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft, endLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(endLeft - tempCenterLeft) + 1) +";\"></div>");} } else if ((yesIn == "2" && endLeft > startLeft) || (yesIn == "1" && (endTop < startTop || endLeft > startLeft)) || (yesIn == "4" && (endTop > startTop || endLeft > startLeft))) {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+(Math.abs(endTop - startTop) + 1) +";\"></div>");}else {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}break;case "3" :if (yesIn == "2") { if ((offset != 3 && offset != 6 && offset != 9) || ((offset == 3 || offset == 6 || offset == 9) && endLeft < startLeft)) {tempCenterTop=startTop - Math.round((startTop - endTop) / 2);AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ Math.min(startTop, tempCenterTop) +"; height: "+ (Math.abs(tempCenterTop - startTop) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(startLeft, endLeft) +"; top: "+ (tempCenterTop - 3) +"; width: "+(Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ Math.min(endTop, tempCenterTop) +"; height: "+ (Math.abs(endTop - tempCenterTop) + 1) +";\"></div>");}else {tempCenterLeft=startLeft - Math.round((startLeft - endLeft) / 2);AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+ (Math.abs(startLeft - tempCenterLeft) + 1) +";\"></div>");if (startTop != endTop) { AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (tempCenterLeft - 3) +"; top: "+ Math.min(startTop, endTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft, endLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(endLeft - tempCenterLeft) + 1) +";\"></div>");}}else if ((yesIn == "3" && endLeft < startLeft) || (yesIn == "1" && (endTop < startTop || endLeft > startLeft || (endLeft < startLeft && endTop > startTop))) || (yesIn == "4" && (endTop > startTop || endLeft > startLeft || (endTop < startTop && endLeft < startLeft)))) { AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}else {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}break;case "4" :if (yesIn == "1") {if (offset<=6 || (offset>6 && endTop<startTop)){tempCenterLeft=startLeft-Math.round((startLeft-endLeft)/2);AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+ (Math.abs(startLeft - tempCenterLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (tempCenterLeft - 3) +"; top: "+ Math.min(startTop, endTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(tempCenterLeft, endLeft) +"; top: "+ (endTop - 3) +"; width: "+ (Math.abs(endLeft - tempCenterLeft) + 1) +";\"></div>");}else {tempCenterTop=startTop-Math.round((startTop-endTop)/2);AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ startTop +"; height: "+ (Math.abs(tempCenterTop - startTop) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (tempCenterTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ tempCenterTop +"; height: "+ (Math.abs(endTop - tempCenterTop) + 1) +";\"></div>");}}else if (yesIn=="4" && endTop>startTop) {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (endTop-3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (startLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}else {AD.append("<div "+ LD +" class=\"flowLineHorizontal1\" style=\"left: "+ Math.min(endLeft, startLeft) +"; top: "+ (startTop - 3) +"; width: "+ (Math.abs(startLeft - endLeft) + 1) +";\"></div>");AD.append("<div "+ LD +" class=\"flowLineVertical1\" style=\"left: "+ (endLeft - 3) +"; top: "+ Math.min(endTop, startTop) +"; height: "+ (Math.abs(endTop - startTop) + 1) +";\"></div>");}break;}if (isNew) {var addTransDiv="<div id=\""+ divID +"\" linkType='"+ linkType +"' divType=\"lineDiv\" transNo=\""+ transNo +"\" yesOut=\""+ yesOut +"\" yesIn=\""+ yesIn +"\" class=\"transDiv\" title=\""+ transitionName +"\">";var addTdataDiv="<div id=\""+ tDataDivID +"\" class=\"tDataDiv\">";$('#divLineConncetion').append(addTransDiv + AD.toString() +"</div>" + addTdataDiv + dataDiv.toString() +"</div>");var tempValue=fromObject.getAttribute("outExist");if (tempValue != "") {tempValue += ",";}fromObject.setAttribute("outExist", tempValue + yesOut);tempValue=toObject.getAttribute("inExist");if (tempValue != "") {tempValue += ",";}toObject.setAttribute("inExist", tempValue + yesIn);if (linkType == "1") {document.forms["dataForm"].elements["STARTFLAG" + TTN].value="1";}}else {TDO2.setAttribute("yesOut", yesOut);TDO2.setAttribute("yesIn", yesIn);TDO2.innerHTML=AD.toString();if (isOpenDialog) {document.getElementById(tDataDivID).innerHTML=dataDiv.toString();TDO2.setAttribute("title", transitionName);}var firstMatch=true;var tempValue=fromObject.getAttribute("outExist");if (tempValue != "") {var tempValueArray=tempValue.split(",");tempValue="";for (var i=0; i < tempValueArray.length; i++) {if (firstMatch && tempValueArray[i] == oldYesOut) {firstMatch=false;}else {tempValue += tempValueArray[i] + ",";}}}fromObject.setAttribute("outExist", tempValue + yesOut);tempValue=toObject.getAttribute("inExist");firstMatch=true;if (tempValue != "") {var tempValueArray=tempValue.split(",");tempValue="";for (var i=0; i < tempValueArray.length; i++) {if (firstMatch && tempValueArray[i] == oldYesIn) {firstMatch=false;}else {tempValue += tempValueArray[i] + ",";}}}toObject.setAttribute("inExist", tempValue + yesIn);}};function deleteDivLine(FTN, TTN) {var divID="transDiv" + FTN + "__" + TTN;var tDataDivID="tDataDiv" + FTN + "__" + TTN;var TDO2=document.getElementById(divID);var TDDO=document.getElementById(tDataDivID);if (TDO2 != null) {var linkType=TDO2.getAttribute("linkType");var yesOut=TDO2.getAttribute("yesOut");var yesIn=TDO2.getAttribute("yesIn");TDO2.outerHTML="";var fromObject=document.getElementById("tacheTable" + FTN);var toObject=document.getElementById("tacheTable" + TTN);var firstMatch=true;var tempValue=fromObject.getAttribute("outExist");if (tempValue != "") {var tempValueArray=tempValue.split(",");tempValue="";for (var i=0; i < tempValueArray.length; i++) {if (firstMatch && tempValueArray[i] == yesOut) {firstMatch=false;}else {tempValue += tempValueArray[i] + ",";}}if (tempValue != "") {tempValue=tempValue.substr(0, tempValue.length - 1);}fromObject.setAttribute("outExist", tempValue);}tempValue=toObject.getAttribute("inExist");firstMatch=true;if (tempValue != "") {var tempValueArray=tempValue.split(",");tempValue="";for (var i=0; i < tempValueArray.length; i++) {if (firstMatch && tempValueArray[i] == yesIn) {firstMatch=false;}else {tempValue += tempValueArray[i] + ",";}}if (tempValue != "") {tempValue=tempValue.substr(0, tempValue.length - 1);}toObject.setAttribute("inExist", tempValue);}if (TDDO != "") {TDDO.outerHTML="";}if (linkType == "1") {document.forms["dataForm"].elements["STARTFLAG" + TTN].value="";}}};function lineDoubleClick(thisObject) {var parentTransDiv=thisObject.getAttribute("parentTransDiv");if (parentTransDiv != null && parentTransDiv != "") {var found_address=parentTransDiv.indexOf("__");var FTN=parentTransDiv.substr(0, found_address);var TTN=parentTransDiv.substr(found_address + 2);createDivLine(FTN, TTN, false, true);}};function tache_dbclick(tacheNo) {var tacheObject=document.getElementById("tacheTable" + tacheNo);if (tacheObject != null) {var tacheTdObject=document.getElementById("tacheTd" + tacheNo);var tacheType=document.forms["dataForm"].elements["TACHETYPE" + tacheNo].value;if (tacheType == "1") {defineTacheStart(tacheNo);}else if (tacheType == "3") {defineTacheEnd(tacheNo);}else {defineTacheStep(tacheNo);}}};function defineTacheStart(tacheNo) {var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var openURL=contextPath + "/wfDeProcess/defineTacheStart?myTime=" + myTime;var PA=[];var tacheTdObject=document.getElementById("tacheTd" + tacheNo);PA['parentWindow']=window;PA['TACHENAME']=tacheTdObject.innerHTML;PA['TACHENAMEDESC']=document.forms["dataForm"].elements["TACHENAMEDESC" + tacheNo].value;var dataOptions={title: '&nbsp;流程开始环节',width: 850,height: 240,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var formObject=iframeObject.$('form').first();if (formObject) {checkComboIsClosed(iframeObject, formObject);if (formObject.form('validate')) {var RO=iframeObject.ok_execute();if (RO == null) {return;}var tacheTdName=RO['TACHENAME'];tacheTdName=tacheTdName.replace("\r\n","<BR>");while (tacheTdName.indexOf("\r\n") >= 0) {tacheTdName=tacheTdName.replace("\r\n"," ");}tacheTdName=tacheTdName.replace("\n","<BR>");while (tacheTdName.indexOf("\n") >= 0) {tacheTdName=tacheTdName.replace("\n"," ");}tacheTdObject.innerHTML=tacheTdName;var tacheName=RO['TACHENAME'];while (tacheName.indexOf("\r\n") >= 0) {tacheName=tacheName.replace("\r\n","");}while (tacheName.indexOf("\n") >= 0) {tacheName=tacheName.replace("\n","");}document.forms["dataForm"].elements["TACHENAME" + tacheNo].value=tacheName;document.forms["dataForm"].elements["TACHENAMEDESC" + tacheNo].value=RO['TACHENAMEDESC'];$('#' + windowID).dialog('close');}}}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);};function defineTacheStep(tacheNo) {var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var PA=[];PA['parentWindow']=window;var existTacheOptions="";for (var i=1; i <= tacheCountValue; i++) {var tacheTableObject=document.getElementById("tacheTable" + i);if (tacheTableObject != null) {var tacheType=document.forms["dataForm"].elements["TACHETYPE" + i].value;if (tacheType == "2" && tacheNo != ("" + i)) {existTacheOptions += "" + i +"="+ document.forms["dataForm"].elements["TACHENAME" + i].value + ",";}}}if (existTacheOptions != "") {existTacheOptions=existTacheOptions.substr(0, existTacheOptions.length - 1);}PA['DEPANDTACHEOPTIONS']=existTacheOptions;var tacheTdObject=document.getElementById("tacheTd" + tacheNo);PA['TACHENAME']=tacheTdObject.innerHTML;PA['TACHENAMEDESC']=document.forms["dataForm"].elements["TACHENAMEDESC" + tacheNo].value;PA['TACHEURL']=document.forms["dataForm"].elements["TACHEURL" + tacheNo].value;PA['LIMITEMINUTE']=document.forms["dataForm"].elements["LIMITEMINUTE" + tacheNo].value;PA['SINGLEMULTI']=document.forms["dataForm"].elements["SINGLEMULTI" + tacheNo].value;PA['MULTIPOLICY']=document.forms["dataForm"].elements["MULTIPOLICY" + tacheNo].value;PA['MULTIPOLICYVALUE']=document.forms["dataForm"].elements["MULTIPOLICYVALUE" + tacheNo].value;PA['PARTICIPANTPOLICY']=document.forms["dataForm"].elements["PARTICIPANTPOLICY" + tacheNo].value;PA['DEPANDTACHEID']=document.forms["dataForm"].elements["DEPANDTACHEID" + tacheNo].value;PA['DEPANDPOLICY']=document.forms["dataForm"].elements["DEPANDPOLICY" + tacheNo].value;PA['DEPANDOTHERCLASS']=document.forms["dataForm"].elements["DEPANDOTHERCLASS" + tacheNo].value;PA['DEPANDOTHERMETHOD']=document.forms["dataForm"].elements["DEPANDOTHERMETHOD" + tacheNo].value;PA['ASSIGNTYPE']=document.forms["dataForm"].elements["ASSIGNTYPE" + tacheNo].value;PA['ASSIGNID']=document.forms["dataForm"].elements["ASSIGNID" + tacheNo].value;PA['SIGNIDEADM']=document.forms["dataForm"].elements["SIGNIDEADM" + tacheNo].value;var urlParameter="ASSIGNTYPE="+ PA['ASSIGNTYPE'] +"&ASSIGNID=" + PA['ASSIGNID'] +"&myTime=" + myTime;var openURL=contextPath + "/wfDeProcess/defineTacheStep?" + urlParameter;var dataOptions={title: '&nbsp;流程流转环节',width: 850,height: 460,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var formObject=iframeObject.$('form').first();if (formObject) {checkComboIsClosed(iframeObject, formObject);if (formObject.form('validate')) {var RO=iframeObject.ok_execute();if (RO == null) {return;}var tacheTdName=RO['TACHENAME'];tacheTdName=tacheTdName.replace("\r\n","<BR>");while (tacheTdName.indexOf("\r\n") >= 0) {tacheTdName=tacheTdName.replace("\r\n"," ");}tacheTdName=tacheTdName.replace("\n","<BR>");while (tacheTdName.indexOf("\n") >= 0) {tacheTdName=tacheTdName.replace("\n"," ");}tacheTdObject.innerHTML=tacheTdName;var tacheName=RO['TACHENAME'];while (tacheName.indexOf("\r\n") >= 0) {tacheName=tacheName.replace("\r\n","");}while (tacheName.indexOf("\n") >= 0) {tacheName=tacheName.replace("\n","");}document.forms["dataForm"].elements["TACHENAME" + tacheNo].value=tacheName;document.forms["dataForm"].elements["TACHENAMEDESC" + tacheNo].value=RO['TACHENAMEDESC'];document.forms["dataForm"].elements["TACHEURL" + tacheNo].value=RO['TACHEURL'];document.forms["dataForm"].elements["LIMITEMINUTE" + tacheNo].value=RO['LIMITEMINUTE'];document.forms["dataForm"].elements["LIMITEDESC" + tacheNo].value=RO['LIMITEDESC'];document.forms["dataForm"].elements["SINGLEMULTI" + tacheNo].value=RO['SINGLEMULTI'];document.forms["dataForm"].elements["MULTIPOLICY" + tacheNo].value=RO['MULTIPOLICY'];document.forms["dataForm"].elements["MULTIPOLICYVALUE" + tacheNo].value=RO['MULTIPOLICYVALUE'];document.forms["dataForm"].elements["PARTICIPANTPOLICY" + tacheNo].value=RO['PARTICIPANTPOLICY'];document.forms["dataForm"].elements["DEPANDTACHEID" + tacheNo].value=RO['DEPANDTACHEID'];document.forms["dataForm"].elements["DEPANDPOLICY" + tacheNo].value=RO['DEPANDPOLICY'];document.forms["dataForm"].elements["DEPANDOTHERCLASS" + tacheNo].value=RO['DEPANDOTHERCLASS'];document.forms["dataForm"].elements["DEPANDOTHERMETHOD" + tacheNo].value=RO['DEPANDOTHERMETHOD'];document.forms["dataForm"].elements["ASSIGNTYPE" + tacheNo].value=RO['ASSIGNTYPE'];document.forms["dataForm"].elements["ASSIGNID" + tacheNo].value=RO['ASSIGNID'];document.forms["dataForm"].elements["SIGNIDEADM" + tacheNo].value=RO['SIGNIDEADM'];$('#' + windowID).dialog('close');}}}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);};function defineTacheEnd(tacheNo) {var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var openURL=contextPath + "/wfDeProcess/defineTacheEnd?myTime=" + myTime;var PA=[];var tacheTdObject=document.getElementById("tacheTd" + tacheNo);PA['parentWindow']=window;PA['TACHENAME']=tacheTdObject.innerHTML;PA['TACHENAMEDESC']=document.forms["dataForm"].elements["TACHENAMEDESC" + tacheNo].value;var dataOptions={title: '&nbsp;流程结束环节',width: 850,height: 240,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var formObject=iframeObject.$('form').first();if (formObject) {checkComboIsClosed(iframeObject, formObject);if (formObject.form('validate')) {var RO=iframeObject.ok_execute();if (RO == null) {return;}var tacheTdName=RO['TACHENAME'];tacheTdName=tacheTdName.replace("\r\n","<BR>");while (tacheTdName.indexOf("\r\n") >= 0) {tacheTdName=tacheTdName.replace("\r\n"," ");}tacheTdName=tacheTdName.replace("\n","<BR>");while (tacheTdName.indexOf("\n") >= 0) {tacheTdName=tacheTdName.replace("\n"," ");}tacheTdObject.innerHTML=tacheTdName;var tacheName=RO['TACHENAME'];while (tacheName.indexOf("\r\n") >= 0) {tacheName=tacheName.replace("\r\n","");}while (tacheName.indexOf("\n") >= 0) {tacheName=tacheName.replace("\n","");}document.forms["dataForm"].elements["TACHENAME" + tacheNo].value=tacheName;document.forms["dataForm"].elements["TACHENAMEDESC" + tacheNo].value=RO['TACHENAMEDESC'];$('#' + windowID).dialog('close');}}}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);};function setEmptySelected() {if (ST != "") {if (ST == "tache") {if (MTO != null) {var curClassName=MTO.className; curClassName=curClassName.replace("2", "1");MTO.className=curClassName;MTO=null;}} else if (ST == "trans") {if (STO != null) {STO.className="transDiv";var objInput= $(STO).find("div");for (var i=0; i < objInput.length; i++) {var objItem=objInput[i];var curClassName=objItem.className; curClassName=curClassName.replace("2", "1");objItem.className=curClassName;}STO=null;}}ST="";SC=0;}flowButtonLine_empty();};function flowButtonLine_over() {if (!BLS) {var flowButtonLineObj=document.getElementById("flowButtonLine");if (flowButtonLineObj != null) {flowButtonLineObj.className="flowButtonLine2";}}};function flowButtonLine_out() {if (!BLS) {var flowButtonLineObj=document.getElementById("flowButtonLine");if (flowButtonLineObj != null) {flowButtonLineObj.className="flowButtonLine1";}}};function flowButtonLine_empty() {BLS=false;var flowButtonLineObj=document.getElementById("flowButtonLine");if (flowButtonLineObj != null) {flowButtonLineObj.className="flowButtonLine1";}};function flowButtonAlign_over() {if (!BA) {var flowButtonAlignObj=document.getElementById("flowButtonAlign");if (flowButtonAlignObj != null) {flowButtonAlignObj.className="flowButtonAlign2";}}};function flowButtonAlign_out() {if (!BA) {var flowButtonAlignObj=document.getElementById("flowButtonAlign");if (flowButtonAlignObj != null) {flowButtonAlignObj.className="flowButtonAlign1";}}};function flowButtonTache_click() {var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var openURL=contextPath + "/wfDeProcess/defineTacheStep?myTime=" + myTime;var PA=[];PA['parentWindow']=window;var existTacheOptions="";for (var i=1; i <= tacheCountValue; i++) {var tacheTableObject=document.getElementById("tacheTable" + i);if (tacheTableObject != null) {var tacheType=document.forms["dataForm"].elements["TACHETYPE" + i].value;if (tacheType == "2") {existTacheOptions += "" + i +"="+ document.forms["dataForm"].elements["TACHENAME" + i].value + ",";}}}if (existTacheOptions != "") {existTacheOptions=existTacheOptions.substr(0, existTacheOptions.length - 1);}PA['DEPANDTACHEOPTIONS']=existTacheOptions;var dataOptions={title: '&nbsp;流程流转环节',width: 850,height: 460,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var formObject=iframeObject.$('form').first();if (formObject) {checkComboIsClosed(iframeObject, formObject);if (formObject.form('validate')) {var RO=iframeObject.ok_execute();if (RO == null) {return;}var tacheTdName=RO['TACHENAME'];tacheTdName=tacheTdName.replace("\r\n","<BR>");while (tacheTdName.indexOf("\r\n") >= 0) {tacheTdName=tacheTdName.replace("\r\n"," ");}tacheTdName=tacheTdName.replace("\n","<BR>");while (tacheTdName.indexOf("\n") >= 0) {tacheTdName=tacheTdName.replace("\n"," ");}var tacheName=RO['TACHENAME'];while (tacheName.indexOf("\r\n") >= 0) {tacheName=tacheName.replace("\r\n","");}while (tacheName.indexOf("\n") >= 0) {tacheName=tacheName.replace("\n","");}tacheCountValue=tacheCountValue + 1;document.getElementById("tacheCount").value=tacheCountValue;var ATS=new StringBuffer();var addTop=12;var panelDivObj=document.getElementById("panelDiv");if (panelDivObj.scrollTop > 0) {addTop=panelDivObj.scrollTop + 12;addTop=Math.round((addTop + AGOT)/12)*12 - AGOT;}ATS.append("<table id=\"tacheTable"+ tacheCountValue +"\" inPlace=\"1,2,3,4\" outPlace=\"4,3,2,1\" inExist=\"\" outExist=\"\" class=\"flowStep1\" style=\"left: 12; top: "+ addTop +";\" ondblclick=\"tache_dbclick("+ tacheCountValue +")\">");ATS.append("<tr><td id=\"tacheTd"+ tacheCountValue +"\" align=\"center\" class=\"tacheName\">"+ tacheTdName +"</td></tr>");ATS.append("</table>");ATS.append("<div id=\"tacheDiv"+ tacheCountValue +"\" style=\"display:none;\">");ATS.append("<input type=\"hidden\" name=\"TACHEID"+ tacheCountValue +"\" anchor=\"TACHEID"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"TACHETYPE"+ tacheCountValue +"\" value=\"2\"/>");ATS.append("<input type=\"hidden\" name=\"TACHENAME"+ tacheCountValue +"\" value=\""+ tacheName +"\"/>");ATS.append("<input type=\"hidden\" name=\"TACHENAMEDESC"+ tacheCountValue +"\" value=\""+ RO['TACHENAMEDESC'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"TACHEURL"+ tacheCountValue +"\" value=\""+ RO['TACHEURL'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"STARTFLAG"+ tacheCountValue +"\" value=\"\"/>");ATS.append("<input type=\"hidden\" name=\"LIMITEMINUTE"+ tacheCountValue +"\" value=\""+ RO['LIMITEMINUTE'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"LIMITEDESC"+ tacheCountValue +"\" value=\""+ RO['LIMITEDESC'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"SINGLEMULTI"+ tacheCountValue +"\" value=\""+ RO['SINGLEMULTI'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"MULTIPOLICY"+ tacheCountValue +"\" value=\""+ RO['MULTIPOLICY'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"MULTIPOLICYVALUE"+ tacheCountValue +"\" value=\""+ RO['MULTIPOLICYVALUE'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"PARTICIPANTPOLICY"+ tacheCountValue +"\" value=\""+ RO['PARTICIPANTPOLICY'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDTACHEID"+ tacheCountValue +"\" value=\""+ RO['DEPANDTACHEID'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDPOLICY"+ tacheCountValue +"\" value=\""+ RO['DEPANDPOLICY'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDOTHERCLASS"+ tacheCountValue +"\" value=\""+ RO['DEPANDOTHERCLASS'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDOTHERMETHOD"+ tacheCountValue +"\" value=\""+ RO['DEPANDOTHERMETHOD'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"ASSIGNTYPE"+ tacheCountValue +"\" value=\""+ RO['ASSIGNTYPE'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"ASSIGNID"+ tacheCountValue +"\" value=\""+ RO['ASSIGNID'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"SIGNIDEADM"+ tacheCountValue +"\" value=\""+ RO['SIGNIDEADM'] +"\"/>");ATS.append("</div>");$('#divTacheDefine').append(ATS.toString());$('#' + windowID).dialog('close');}}}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);};function flowButtonEnd_click() {var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var openURL=contextPath + "/wfDeProcess/defineTacheEnd?myTime=" + myTime;var PA=[];PA['parentWindow']=window;PA['TACHENAME']="";PA['TACHENAMEDESC']="";var dataOptions={title: '&nbsp;流程结束环节',width: 850,height: 240,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var formObject=iframeObject.$('form').first();if (formObject) {checkComboIsClosed(iframeObject, formObject);if (formObject.form('validate')) {var RO=iframeObject.ok_execute();if (RO == null) {return;}var tacheTdName=RO['TACHENAME'];tacheTdName=tacheTdName.replace("\r\n","<BR>");while (tacheTdName.indexOf("\r\n") >= 0) {tacheTdName=tacheTdName.replace("\r\n"," ");}tacheTdName=tacheTdName.replace("\n","<BR>");while (tacheTdName.indexOf("\n") >= 0) {tacheTdName=tacheTdName.replace("\n"," ");}var tacheName=RO['TACHENAME'];while (tacheName.indexOf("\r\n") >= 0) {tacheName=tacheName.replace("\r\n","");}while (tacheName.indexOf("\n") >= 0) {tacheName=tacheName.replace("\n","");}tacheCountValue=tacheCountValue + 1;document.getElementById("tacheCount").value=tacheCountValue;var ATS=new StringBuffer();var addTop=12;var panelDivObj=document.getElementById("panelDiv");if (panelDivObj.scrollTop > 0) {addTop=panelDivObj.scrollTop + 12;addTop=Math.round((addTop + AGOT)/12)*12 - AGOT;}ATS.append("<table id=\"tacheTable"+ tacheCountValue +"\" inPlace=\"1,2,3,4\" outPlace=\"\" inExist=\"\" outExist=\"\" class=\"flowEnd1\" style=\"left: 12; top: "+ addTop +";\" ondblclick=\"tache_dbclick("+ tacheCountValue +")\">");ATS.append("<tr><td id=\"tacheTd"+ tacheCountValue +"\" align=\"center\" class=\"tacheName\">"+ tacheTdName +"</td></tr>");ATS.append("</table>");ATS.append("<div id=\"tacheDiv"+ tacheCountValue +"\" style=\"display:none;\">");ATS.append("<input type=\"hidden\" name=\"TACHEID"+ tacheCountValue +"\" anchor=\"TACHEID"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"TACHETYPE"+ tacheCountValue +"\" value=\"3\"/>");ATS.append("<input type=\"hidden\" name=\"TACHENAME"+ tacheCountValue +"\" value=\""+ tacheName +"\"/>");ATS.append("<input type=\"hidden\" name=\"TACHENAMEDESC"+ tacheCountValue +"\" value=\""+ RO['TACHENAMEDESC'] +"\"/>");ATS.append("<input type=\"hidden\" name=\"TACHEURL"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"STARTFLAG"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"LIMITEMINUTE"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"LIMITEDESC"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"SINGLEMULTI"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"MULTIPOLICY"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"MULTIPOLICYVALUE"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"PARTICIPANTPOLICY"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDTACHEID"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDPOLICY"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDOTHERCLASS"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"DEPANDOTHERMETHOD"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"ASSIGNTYPE"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"ASSIGNID"+ tacheCountValue +"\"/>");ATS.append("<input type=\"hidden\" name=\"SIGNIDEADM"+ tacheCountValue +"\"/>");ATS.append("</div>");$('#divTacheDefine').append(ATS.toString());$('#' + windowID).dialog('close');}}}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);};function flowButtonCheck_click(correctAlert) {setEmptySelected();var EC=0;var ES="";var existTacheFlag=false;var existEndFlag=false;var existProcessEndFlag=false;var existDepandTacheID="";var depandCycleCheck=true;for (var i=1; i <= tacheCountValue; i++) {var tacheTableObject=document.getElementById("tacheTable" + i);if (tacheTableObject != null) {var tacheType=document.forms["dataForm"].elements["TACHETYPE" + i].value;if (tacheType == "1") {if (tacheTableObject.getAttribute("outExist") == "") {EC ++;ES += EC +"、【"+ document.forms["dataForm"].elements["TACHENAME" + i].value +"】环节没有正确的流向连接！ <br>";}}else if (tacheType == "3") {if (tacheTableObject.getAttribute("inExist") == "") {EC ++;ES += EC +"、【"+ document.forms["dataForm"].elements["TACHENAME" + i].value +"】环节没有正确的流向连接！ <br>";}existEndFlag=true;}else {if (tacheTableObject.getAttribute("inExist") == "" || tacheTableObject.getAttribute("outExist") == "") {EC ++;ES += EC +"、【"+ document.forms["dataForm"].elements["TACHENAME" + i].value +"】环节没有正确的流向连接！<br>";}existTacheFlag=true;var startFlagValue=document.forms["dataForm"].elements["STARTFLAG" + i].value;var depandTacheID=document.forms["dataForm"].elements["DEPANDTACHEID" + i].value;if (startFlagValue == "1") {if (depandTacheID != "") {EC ++;ES += EC +"、【"+ document.forms["dataForm"].elements["TACHENAME" + i].value +"】为第一个流转环节，不能有环节参与者依赖！<br>";}var singlemultiValue=document.forms["dataForm"].elements["SINGLEMULTI" + i].value;if (singlemultiValue == "2") {EC ++;ES += EC +"、【"+ document.forms["dataForm"].elements["TACHENAME" + i].value +"】为第一个流转环节，不能为多人环节！ <br>";}}if (depandTacheID != "") {existDepandTacheID += i + ",";var depandTacheObj=document.forms["dataForm"].elements["TACHENAME" + depandTacheID];if (depandTacheObj == null) {depandCycleCheck=false;EC ++;ES += EC +"、【"+ document.forms["dataForm"].elements["TACHENAME" + i].value +"】环节的参与者依赖环节不存在！<br>";}}}}}for (var i=1; i <= transCountValue; i++) {var processEndObject=document.forms["dataForm"].elements["PROCESSEND" + i];if (processEndObject != null) {if (processEndObject.value == "1") {existProcessEndFlag=true;break;}}}if (!existTacheFlag) {EC ++;ES += EC +"、流程中没有定义具体的【流转环节】！<br>";}if (!existEndFlag) { EC ++; ES += EC +"、流程中没有【结束】环节！ <br>";}if (!existProcessEndFlag) { EC ++; ES += EC +"、流程中没有流程结束的环节流向！<br>";}if (depandCycleCheck && existDepandTacheID != "") {existDepandTacheID=existDepandTacheID.substr(0, existDepandTacheID.length - 1);var existDepandIDArray=existDepandTacheID.split(",");for (var i=0; i < existDepandIDArray.length; i++) {var depandTacheID=existDepandIDArray[i];var depandTachePath="," + depandTacheID + ",";var depandTachePathName=document.forms["dataForm"].elements["TACHENAME" + depandTacheID].value;var cycleFlag=false;while (true) {var parentDepandTacheID=document.forms["dataForm"].elements["DEPANDTACHEID" + depandTacheID].value;if (parentDepandTacheID == "") {break;}else {if (depandTachePath.indexOf("," + parentDepandTacheID + ",") != -1) {depandTachePathName += " -> " + document.forms["dataForm"].elements["TACHENAME" + parentDepandTacheID].value;cycleFlag=true;break;}depandTachePathName += " -> " + document.forms["dataForm"].elements["TACHENAME" + parentDepandTacheID].value;depandTachePath += parentDepandTacheID + ",";depandTacheID=parentDepandTacheID;}}if (cycleFlag) {EC ++;ES += EC +"、流程环节的参与者依赖不能形成循环：<br> "+ depandTachePathName;break;}}}if (EC > 0) {topMessagerAlert("", " <br>流程定义中有 "+ EC +" 个错误：<br><br><br>"+ ES);return false;}else {if (correctAlert) {topMessagerAlert("", "流程定义正确！");}return true;}};function flowButtonRefresh_click() {setEmptySelected();var panelDivObj=document.getElementById("panelDiv");if (panelDivObj == null) {return;}panelDivObj.innerHTML=panelDivObj.innerHTML + "";};function flowButtonAlign_click() {setEmptySelected();var flowButtonAlignObj=document.getElementById("flowButtonAlign");if (flowButtonAlignObj != null) {if (BA) {BA=false;flowButtonAlignObj.className="flowButtonAlign2";}else {BA=true;flowButtonAlignObj.className="flowButtonAlign3";}}};function flowButtonNew_click() {if (initFlag == "1") {topMessagerAlert('', '该流程数据已经被保存了，不能类似创建！');return;}var openNewAs=true;var existTache=false;for (var i=1; i <= tacheCountValue; i++) {var tacheTableObject=document.getElementById("tacheTable" + i);if (tacheTableObject != null) {var tacheType=document.forms["dataForm"].elements["TACHETYPE" + i].value;if (tacheType == "2" || tacheType == "3") {existTache=true;break;}}}if (existTache) {topMessager.confirm('', '您已经定义了部分流程数据，是否要类似创建？', function(r) {if (r) {createNewAsSelect();}});}else {createNewAsSelect();}};function createNewAsSelect() {var isCache=false;var myTime=(new Date()).getTime();var windowID="win_" + myTime;var openURL=contextPath + "/wfDeProcess/defineNewAs?id=" + document.forms["dataForm"].elements["id"].value;var PA=[];PA['parentWindow']=window;var dataOptions={title: '&nbsp;流程类似创建模板选择',width: 850,height: 420,collapsible: false, minimizable: false, maximizable: false,closable: true,closed: false, cache: false,inline: false,modal: true};dataOptions.buttons=[{text: '确定',iconCls: 'icon-ok',handler: function() {var iframeObject=window.frames[windowID + '_iframe'];if (iframeObject.contentWindow) {iframeObject=iframeObject.contentWindow;}var newAsId=iframeObject.ok_execute();if (newAsId == 0) {return;}createNewAs(newAsId);$('#' + windowID).dialog('close');}},{text: '关闭',iconCls: 'icon-cancel',handler: function() {$('#' + windowID).dialog('close');}}];openWindow(isCache, windowID, openURL, PA, dataOptions);};function createNewAs(newAsId) {$.ajax({type: "POST",url: contextPath + "/wfDeProcess/queryHtmlcontent",data: "id=" + newAsId,success: function(data) {if (data == null || data == "") {topMessagerAlert("", "类似创建，读取流程模板数据错误！");}else {document.getElementById("panelDiv").innerHTML=data;tacheCountValue=document.getElementById("tacheCount").value;if (tacheCountValue == "" || tacheCountValue == "0") {tacheCountValue=1;}else {tacheCountValue=parseInt(tacheCountValue);}transCountValue=document.getElementById("transCount").value;if (transCountValue == "") {transCountValue=0;document.getElementById("transCount").value="0";}else {transCountValue=parseInt(transCountValue);}for (var i=1; i <= tacheCountValue; i++) {var tacheTableObject=document.getElementById("tacheTable" + i);if (tacheTableObject != null) {document.forms["dataForm"].elements["TACHEID" + i].value="";}}}}});};