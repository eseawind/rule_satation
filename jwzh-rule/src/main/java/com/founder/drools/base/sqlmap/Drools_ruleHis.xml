<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Drools_ruleHis">
	
	<typeAlias alias="drools_ruleHis" type="com.founder.drools.base.model.Drools_ruleHis" />
		
    <insert id="insert" parameterClass="drools_ruleHis">
       insert into DROOLS_RULEHIS
       (
        version        
		<isNotEmpty prepend="," property="serviceid"><![CDATA[ serviceid]]></isNotEmpty>
		<isNotEmpty prepend="," property="servicename"><![CDATA[ servicename]]></isNotEmpty>
		<isNotEmpty prepend="," property="serviceurl"><![CDATA[ serviceurl]]></isNotEmpty>
		<isNotEmpty prepend="," property="groupid"><![CDATA[ groupid]]></isNotEmpty>
		<isNotEmpty prepend="," property="groupname"><![CDATA[ groupname]]></isNotEmpty>
		<isNotEmpty prepend="," property="rulefilename"><![CDATA[ rulefilename]]></isNotEmpty>
		<isNotEmpty prepend="," property="content"><![CDATA[ content]]></isNotEmpty>
		<isNotEmpty prepend="," property="ruleid"><![CDATA[ ruleid]]></isNotEmpty>
		<isNotEmpty prepend="," property="servicemethod"><![CDATA[ servicemethod]]></isNotEmpty>
       )VALUES(
       	#version#       	
		<isNotEmpty prepend="," property="serviceid"><![CDATA[#serviceid#]]></isNotEmpty>
		<isNotEmpty prepend="," property="servicename"><![CDATA[#servicename#]]></isNotEmpty>
		<isNotEmpty prepend="," property="serviceurl"><![CDATA[#serviceurl#]]></isNotEmpty>
		<isNotEmpty prepend="," property="groupid"><![CDATA[#groupid#]]></isNotEmpty>
		<isNotEmpty prepend="," property="groupname"><![CDATA[#groupname#]]></isNotEmpty>
		<isNotEmpty prepend="," property="rulefilename"><![CDATA[#rulefilename#]]></isNotEmpty>
		<isNotEmpty prepend="," property="content"><![CDATA[#content#]]></isNotEmpty>
		<isNotEmpty prepend="," property="ruleid"><![CDATA[#ruleid#]]></isNotEmpty>
		<isNotEmpty prepend="," property="servicemethod"><![CDATA[ #servicemethod#]]></isNotEmpty>
       )
    </insert>	
    
    <!-- 查询规则平台规则历史表-->
    <select id="queryRuleHis" parameterClass="drools_ruleHis" resultClass="drools_ruleHis">
         select * from DROOLS_RULEHIS
		 where 1=1	
		 <isNotEmpty prepend=" and " property="version">VERSION = #version#</isNotEmpty>
		<isNotEmpty prepend=" and " property="serviceid">SERVICEID = #serviceid#</isNotEmpty>
		<isNotEmpty prepend=" and " property="servicename"><![CDATA[SERVICENAME like '%$servicename$%' ]]></isNotEmpty>		
		<isNotEmpty prepend=" and " property="groupid">GROUPID = #groupid#</isNotEmpty>
		<isNotEmpty prepend=" and " property="groupname"><![CDATA[GROUPNAME like '%$groupname$%' ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="rulefilename"><![CDATA[ RULEFILENAME like '%$rulefilename$%' ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="ruleid">RULEID = #ruleid#</isNotEmpty>	
		
		order by VERSION DESC	
    </select>
    
    <!-- 查询管理列表 -->
    <select id="queryRuleHisManagerList" parameterClass="drools_ruleHis" resultClass="drools_ruleHis">
	    select * from DROOLS_RULEHIS where VERSION in(
			select max(VERSION) from DROOLS_RULEHIS group by RULEID
		) 
		
		 <isNotEmpty prepend=" and " property="version">VERSION = #version#</isNotEmpty>
		<isNotEmpty prepend=" and " property="serviceid">SERVICEID = #serviceid#</isNotEmpty>
		<isNotEmpty prepend=" and " property="servicename"><![CDATA[SERVICENAME like '%$servicename$%' ]]></isNotEmpty>		
		<isNotEmpty prepend=" and " property="groupid">GROUPID = #groupid#</isNotEmpty>
		<isNotEmpty prepend=" and " property="groupname"><![CDATA[GROUPNAME like '%$groupname$%' ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="rulefilename"><![CDATA[ RULEFILENAME like '%$rulefilename$%' ]]></isNotEmpty>
		<isNotEmpty prepend=" and " property="ruleid">RULEID = #ruleid#</isNotEmpty>	
		
		order by VERSION DESC
    </select>
    
    <delete id="deleteRuleHis" parameterClass="drools_rule">
    	delete from DROOLS_RULEHIS where VERSION = #version#
    </delete>
</sqlMap>